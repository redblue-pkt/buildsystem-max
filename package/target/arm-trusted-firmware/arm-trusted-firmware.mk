#
# arm-trusted-firmware
#
ARM_TRUSTED_FIRMWARE_VER    = git
ARM_TRUSTED_FIRMWARE_DIR    = arm-trusted-firmware.git
ARM_TRUSTED_FIRMWARE_SOURCE = arm-trusted-firmware.git
ARM_TRUSTED_FIRMWARE_SITE   = https://github.com/ARM-software
ARM_TRUSTED_FIRMWARE_DEPS   = bootstrap

ARM_TRUSTED_FIRMWARE_DEBUG  = false

ifeq ($(BOXMODEL),$(filter $(BOXMODEL),orangepioneplus))
ARM_TRUSTED_FIRMWARE_PLAT = sun50i_h6
endif

ifeq ($(ARM_TRUSTED_FIRMWARE_DEBUG),true)
ARM_TRUSTED_FIRMWARE_OPTION = debug
ARM_TRUSTED_FIRMWARE_DEBUG_OPTION = 1
else
ARM_TRUSTED_FIRMWARE_OPTION = release
ARM_TRUSTED_FIRMWARE_DEBUG_OPTION = 0
endif

$(D)/arm-trusted-firmware:
	$(START_BUILD)
	$(PKG_REMOVE)
	$(call PKG_DOWNLOAD,$(PKG_SOURCE))
	$(call PKG_UNPACK,$(BUILD_DIR))
	$(PKG_APPLY_PATCHES)
	$(PKG_CHDIR); \
		$(MAKE) CROSS_COMPILE=$(TARGET_CROSS) PLAT=$(ARM_TRUSTED_FIRMWARE_PLAT) DEBUG=$(ARM_TRUSTED_FIRMWARE_DEBUG_OPTION) bl31; \
		$(INSTALL_EXEC) -D $(PKG_BUILD_DIR)/build/$(ARM_TRUSTED_FIRMWARE_PLAT)/$(ARM_TRUSTED_FIRMWARE_OPTION)/bl31.bin $(TARGET_DIR)/boot
	$(PKG_REMOVE)
	$(TOUCH)

